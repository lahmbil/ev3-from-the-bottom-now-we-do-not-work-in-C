<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Swagboy: An EV3 Mindstorms puck grabber</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Swagboy
   </div>
   <div id="projectbrief">An EV3 Mindstorms puck grabber</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">An EV3 Mindstorms puck grabber </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="swagboy.png"/>
</div>
<p>Swagboy is a puck grabber robot. Equipped with 2 wheels, powered by 2 EV3 large motors, 1 claw, powered by 1 EV3 medium motor, 1 ultrasonic sensor, 1 touch sensor and 1 color sensor.</p>
<p>Against another robot, its aim is to grab the largest number of pucks and to put them in the other robot's goal, in a fixed amount of time.</p>
<p>Swagboy is written in C, and uses <a href="https://www.ev3dev.org/">EV3Dev</a> (Stretch Snapshot 12012018) and <a href="http://in4lio.github.io/ev3dev-c/">EV3Dev-c</a>.</p>
<p>This documentation was generated by Doxygen.</p>
<h2>Structure</h2>
<p>This project can be split into 5 modules:</p>
<ul>
<li>Wheels</li>
<li>Claw</li>
<li>Sensors</li>
<li>Pathfinding</li>
<li>Controller</li>
</ul>
<p><b>Wheels</b> manages the wheels and the 2 large motors. EV3Dev-c being a crude library, this module abstracts a lot of basic movements like traveling a certain distance or rotating. It also calculates the position of the robot on the field. This feature is only assured to work if the speed is set to 30% of the maximum. It can also navigate on a field filled with obstacles, using <b>Pathfinding</b>. The config file is not yet implemented, so if you wish to use this program on your robot, you either need to modify the sources and recompile them or change the ports used by your robot: left motor <em>A</em>, right motor <em>B</em>, medium motor <em>D</em>.</p>
<p><b>Pathfinding</b> uses the A* implementation of <a href="https://www.bedroomlan.org/projects/libastar/">libastar</a>. The project was rewritten near the end of the deadline, and there was not enough time to write our own implementation. This library uses a GPL licensing and so this project falls under this license while using it. There are not a lot of library for pathfinding in C.</p>
<p><b>Claw</b> manages the claw of the robot: initialization, opening, and closing are the operations supported.</p>
<p><b>Sensors</b> manages all the sensors of the robot. Call <a class="el" href="sensors_8c.html#a2405d658b2173e87c28b64b102994b82" title="Tries to find an ultrasonic sensor, a touch sensor, and a color sensor and to initialize them...">init_sensors()</a> once and start to call <a class="el" href="sensors_8c.html#a493f5038e9e4474472e576a38ab4d068">get_distance()</a>, <a class="el" href="sensors_8c.html#a7b792e4988d597c47c917968204d3514">get_color()</a> and <a class="el" href="sensors_8c.html#aa23cb928c298d8b01dc8d2182caf37d7">is_pressed()</a>. The ports are written in the source file directly so if you wish to use this program on your robot, make sure to recompile the sources or to set the sensors to the same ports as us: sonic sensor <em>S1</em>, color sensor <em>S2</em> and touch sensor <em>S3</em>. Next release should introduce a config file.</p>
<p><b>Controller</b> manages all the logic and decision making of the robot. You only need to call <a class="el" href="controller_8c.html#a54b55b119fdadc6ceabfead41ef23be7" title="Puts together a robot with 2 wheels, 1 claw, 1 ultrasonic sensor, 1 touch sensor, 1 color_sensor...">controller()</a> in your main function.</p>
<h2>Development</h2>
<p>EV3Dev-C is built on EV3Dev Jessie. EV3Dev Stretch introduced some breaking changes, like port naming. If you wish to compile the sources, your first need to change ev3_port.c and ev3_both.h and to recompile EV3Dev-C.</p>
<p>In the function ev3_parse_port_name in ev3_port.c:</p>
<div class="fragment"><div class="line">*port = EV3_PORT__NONE;</div><div class="line">*extport = EV3_PORT__NONE;</div><div class="line">*addr = 0;</div><div class="line"></div><div class="line"><span class="keywordtype">char</span>* platform_prefix = strchr(name, <span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><span class="keywordflow">if</span> (platform_prefix)</div><div class="line">    name = platform_prefix + 1;</div></div><!-- fragment --><p>In the header ev3_both.h, the correct GPIO_KEYS_PATH:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define GPIO_KEYS_PATH &quot;/dev/input/by-path/platform-gpio_keys-event&quot;</span></div></div><!-- fragment --><p>In libastar, astar_heap.h:</p>
<div class="fragment"><div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span></div><div class="line">astar_heap_clear (asheap_t * heap) {</div><div class="line"></div><div class="line">    assert(heap != NULL);</div><div class="line">    heap-&gt;length = 0;</div><div class="line">}</div></div><!-- fragment --><p>And astar.h, add the following definition:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> astar_destroy (astar_t * as);</div></div><!-- fragment --><p>The project is cross compiled with Docker (see: <a href="https://github.com/in4lio/ev3dev-c/tree/master/docker">https://github.com/in4lio/ev3dev-c/tree/master/docker</a>). Once you have your image of ev3dev/debian-stretch-cross ready, by making some small changes to <em>script.sh</em>, you can easily compile and launch the program.</p>
<p>In any case, do not compile with the makefile generated by cmake. We only use it to tell our IDE where the sources are for the autocompletion.</p>
<p>We suppose libastar's sources are located inside an "astar" directory, inside the ev3 sources folder.</p>
<p>EV3Dev Stretch fixes a lot of bugs, such as the color space of the color sensor, which could only previously detect 2 colors in our use case, and adds a bit of motor synchronization.</p>
<h2>Known bugs</h2>
<p>We suspect some memory leaks. Valgrind is not available for our architecture. <a href="http://memwatch.sourceforge.net/">Memwatch</a> is not detecting anything strange, but the <b>free</b> command used before launching the program, and after, shows us that all the memory is not freed. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
